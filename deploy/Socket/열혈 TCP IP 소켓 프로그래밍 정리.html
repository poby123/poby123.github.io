<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Otomanopee+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/resources/index.css" />
    <title>원주의 Memo | 열혈 TCP IP 소켓 프로그래밍 정리</title>
</head>

<body>
    <section class="content">
        <div class="container">
            <h2>
                열혈 TCP IP 소켓 프로그래밍 정리
            </h2>
            <article>
    <div><span style="font-size: large; font-weight: bold;">File Descriptor (File Handle)</span><br></div><div>&nbsp; 0 : Standard Input</div><div>&nbsp; 1 : Standard Output</div><div>&nbsp; 2 : Standard Error</div><div><br></div><div><span style="font-weight: bold;">소켓의 생성</span></div><div><span style="background-color: rgb(255, 255, 255); font-weight: bold;">&gt; <span style="color: rgb(235, 20, 76);">int</span> socket(int<span style="color: rgb(255, 105, 0);"> __domain</span>, int <span style="color: rgb(6, 147, 227);">__type</span>, int <span style="color: rgb(153, 0, 239);">__protocol</span>)&nbsp;</span><br></div><div><span style="background-color: rgb(255, 255, 255);">&nbsp; <span style="color: rgb(255, 105, 0); font-weight: bold;">_domain</span> : 소켓이 사용할 프로토콜 정보 전달.</span><br></div><div><div style="font-size: inherit;"><div style="">&nbsp;&nbsp;<span style="font-size: inherit;">&nbsp; -&nbsp;</span><span style="font-size: inherit; background-color: rgb(255, 255, 255);">PF_INET&nbsp; &nbsp;: IPv4</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; -&nbsp;</span><span style="font-size: inherit;">PF_INET6 : IPv6</span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; -&nbsp;</span><span style="font-size: inherit;">PF_LOCAL : 로컬 통신을 위한 UNIX 프로토콜</span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; -&nbsp;</span><span style="font-size: inherit;">PF_PACKET : Low Level 소켓을 위한 프로토콜</span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; -&nbsp;</span><span style="font-size: inherit;">PF_IPX : IPX 노벨 프로토콜</span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><span style="font-weight: bold;">&nbsp; </span><span style="font-weight: bold; color: rgb(6, 147, 227);">__type : </span>소켓의 타입. 소켓의 데이터 전송방식</span></span></div><div style=""><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; - SOCK_STREAM : 연결지향형 소켓(데이터 경계x, 순차적. 신뢰도 높음. 바이트 기반.)</span><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; -&nbsp;SOCK_DGRAM : 비 연결지향형 소켓(</span><span style="font-size: inherit;">데이터 경계o,&nbsp;</span><span style="font-size: inherit;">비순차적. 신뢰도 낮음. 고속 전송 목적.)&nbsp;</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit; font-weight: bold;">&nbsp; <span style="color: rgb(153, 0, 239);">__protocol :&nbsp;</span></span></span><span style="background-color: rgb(255, 255, 255); font-size: inherit;">소켓의 타입. 소켓의 데이터 전송방식</span><span style="font-size: inherit; font-weight: bold; background-color: rgb(255, 255, 255);">&nbsp;</span></div><div style=""><span style="font-size: inherit;">&nbsp;&nbsp;</span><span style="font-size: inherit;">&nbsp; - 대체로 이 인자는 0을 넘겨주면 되지만, "하나의 프로토콜 체계에서 전송방식이 여러개 존재하는 경우"를 위해 존재한다.</span><span style="font-size: inherit; font-weight: bold; background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="font-size: inherit;"><br></span></div><div style=""><span style="font-size: inherit; font-weight: bold;">&nbsp; <span style="color: rgb(235, 20, 76);">"성공시 파일 디스크립터, 실패시 -1 반환"</span></span></div><div style=""><span style="font-size: inherit; font-weight: bold; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;&nbsp;</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><b>IPv4 기반의 주소표현을 위한 구조체:&nbsp;</b></span></span><span style="font-size: inherit; background-color: rgb(255, 255, 255); font-weight: bold;">sockaddr_in과 sockaddr</span></div><div style=""><div style="font-size: inherit; background-color: rgb(0, 0, 0);"><span style="color: rgb(0, 208, 132);">&nbsp;struct</span><span style="color: rgb(255, 255, 255);"> sockaddr_in {</span></div><div style="background-color: rgb(0, 0, 0); font-size: inherit;"><span style="color: rgb(255, 255, 255);">&nbsp; &nbsp;</span><span style="color: rgb(0, 208, 132);">sa_family_t</span><span style="color: rgb(255, 255, 255);"> sin_family;&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(247, 141, 167);">// 주소 체계 : ( AF_INET / AF_INET6 / AF_LOCAL )</span></div><div style="font-size: inherit; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">&nbsp; &nbsp;</span><span style="color: rgb(0, 208, 132);">uint16_t</span><span style="color: rgb(255, 255, 255);"> sin_port;</span><span style="font-size: inherit; color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-size: inherit; color: rgb(247, 141, 167);">// 16비트 TCP/UDP 포트번호 -&nbsp;</span><span style="color: rgb(235, 20, 76); font-size: inherit;">(네트워크 바이트 순서로 저장해야함.)</span></div><div style="background-color: rgb(0, 0, 0); font-size: inherit;"><span style="color: rgb(255, 255, 255);">&nbsp; &nbsp;</span><span style="color: rgb(0, 208, 132);">struct</span><span style="color: rgb(255, 255, 255);"> </span><span style="color: rgb(6, 147, 227);">in_addr</span><span style="color: rgb(255, 255, 255);"> sin_addr;</span><span style="font-size: inherit; color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-size: inherit; color: rgb(247, 141, 167);">// 32비트 IP 주소 - </span><span style="font-size: inherit; color: rgb(235, 20, 76);">(네트워크 바이트 순서로 저장해야함.)</span></div><div style="background-color: rgb(0, 0, 0); font-size: inherit;"><span style="color: rgb(255, 255, 255);">&nbsp; &nbsp;</span><span style="color: rgb(0, 208, 132);">char</span><span style="color: rgb(255, 255, 255);"> sin_zero[8];</span><span style="font-size: inherit; color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-size: inherit; color: rgb(247, 141, 167);">// 사용되지 않음. sockaddr과 크기를 일치시키기 위해 만들어놓은 것. 0으로 채움.</span></div><div style="background-color:#000000; font-size:inherit; color:#ffffff;">&nbsp;}</div>※<span style="font-size: inherit; background-color: rgb(255, 255, 255); font-style: italic;">bind()</span><span style="background-color: rgb(255, 255, 255); font-size: inherit;">는 </span><span style="font-size: inherit; background-color: rgb(255, 255, 255); font-style: italic;">sockaddr</span><span style="background-color: rgb(255, 255, 255); font-size: inherit;">을 필요로 하지만, 사용하기 불편하기 때문에, <span style="font-style: italic;">sockaddr_in</span>을 형변환해서 사용한다.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit; font-weight: bold;">네트워크의 바이트 순서</span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);">&gt; 네트워크의 바이트 순서는 <span style="text-decoration-line: underline;">빅-엔디안 방식</span>으로 통일한다. 이를 위해 다음과 같은 함수들이 있다.</span></div><div style=""><div style="font-size: inherit;"><div style=""><div style="background-color: rgb(0, 0, 0); font-size: inherit;"><div style=""><span style="color: rgb(255, 255, 255);">short 2byte : 주로 포트번호 변환에 사용한다.</span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">&nbsp; - unsigned short htons(unsigend short); // short형 데이터를 host 바이트 순서 -&gt; network 바이트 순서</span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;</span><span style="font-size: inherit;">&nbsp;</span>- unsigned short ntohs(unsigned short);&nbsp;</span><span style="color: rgb(255, 255, 255); font-size: inherit;">// short형 데이터를 network 바이트 순서 -&gt; host 바이트 순서</span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255); font-size: inherit;"><br></span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255); font-size: inherit;">long 4byte : 주로 IP주소 변환에 사용한다.</span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;</span><span style="font-size: inherit;">&nbsp;</span>- unsigned long htonl(unsigned long);&nbsp;&nbsp;</span><span style="color: rgb(255, 255, 255); font-size: inherit;">// long형 데이터를 host 바이트 순서 -&gt; network 바이트 순서</span></div><div style="color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);"><span style="font-size: inherit;">&nbsp;</span><span style="font-size: inherit;">&nbsp;</span>- unsigned long ntohl(unsigned long);&nbsp;&nbsp;</span><span style="color: rgb(255, 255, 255); font-size: inherit;">// long형 데이터를 network 바이트 순서 -&gt; host 바이트 순서</span></div></div></div></div></div><div style=""><br></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><b>문자열을 네트워크 바이트 순서의 정수로 변환하기 :&nbsp;</b></span></span><span style="background-color: rgb(255, 255, 255); font-weight: 700; font-size: inherit;">#include&lt;arpa/inet.h&gt;</span></div><div style=""><span style="font-weight: 700; background-color: rgb(255, 255, 255);">&gt; <span style="color: rgb(6, 147, 227);">in_addr_t</span> inet_addr(<span style="color: rgb(0, 208, 132);">const char*</span> string</span><span style="font-weight: 700; background-color: rgb(255, 255, 255);">)</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">"219.214.107.36"과 같은 IP주소를 <span style="text-decoration-line: underline;">32비트 정수</span>로 변환해준다.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">성공 시 빅 엔디안으로 변환된 32비트 정수값, 실패 시 <span style="font-style: italic;">INADDR_NONE</span> 반환</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">&nbsp;</span></div><div style=""><span style="font-weight: 700; background-color: rgb(255, 255, 255);">&gt; <span style="color: rgb(6, 147, 227);">int</span> inet_aton(<span style="color: rgb(0, 208, 132);">const char*</span> string, <span style="color: rgb(0, 208, 132);">struct </span><span style="color: rgb(6, 147, 227);">in_addr*</span><span style="color: rgb(0, 208, 132);">&nbsp;</span>addr</span><span style="font-weight: 700; background-color: rgb(255, 255, 255);">)</span><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="background-color: rgb(255, 255, 255);">"219.214.107.36"과 같은 IP주소를 32비트 정수로 변환해준다.</span><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255);">string: 변환할 IP주소, addr: 변환된 정보를 저장할 변수</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">성공은 1, 실패는 0 을 반환.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: inherit;"><br></span></span></div><div style=""><span style="font-weight: 700; background-color: rgb(255, 255, 255);">&gt;&nbsp;<span style="color: rgb(6, 147, 227);">char*</span>&nbsp;inet_ntoa(<span style="color: rgb(0, 208, 132);">struct </span><span style="color: rgb(6, 147, 227);">in_addr</span><span style="color: rgb(0, 208, 132);">&nbsp;</span>addr</span><span style="font-weight: 700; background-color: rgb(255, 255, 255);">)</span><br></div><div style=""><span style="background-color: rgb(255, 255, 255);">정수형태의 IP주소를 문자열 형태의 IP주소로 변환한다.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">함수 내부적으로 문자열을 메모리에 저장하고 변환하기 때문에, 다시 이 함수를 호출할 때 그 문자열이 달라질 수 있다. 따라서 <span style="font-style: italic;">strcpy</span> 같은 함수를 통해 배열에 저장해놓는 것이 좋다.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255); font-weight: bold;">소켓에 주소 할당하기</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">&gt;&nbsp;</span><span style="font-size: inherit; font-weight: 700; background-color: rgb(255, 255, 255);"><span style="color: rgb(6, 147, 227);">int</span>&nbsp;bind(<span style="color: rgb(0, 208, 132);">int</span>&nbsp;sockfd,&nbsp;</span><span style="font-size: inherit; font-weight: 700; color: rgb(0, 208, 132);">struct </span><span style="font-size: inherit; font-weight: 700; color: rgb(6, 147, 227);">sockaddr</span><span style="font-size: inherit; font-weight: 700; color: rgb(0, 208, 132);">*</span><span style="font-size: inherit; font-weight: 700; background-color: rgb(255, 255, 255);">&nbsp;myaddr,&nbsp;</span><span style="font-size: inherit; font-weight: 700; color: rgb(0, 208, 132);">socketlen_t</span><span style="font-size: inherit; font-weight: 700; background-color: rgb(255, 255, 255);">&nbsp;addrlen</span><span style="background-color: rgb(255, 255, 255); font-size: inherit; font-weight: 700;">)</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">socketfd : 주소 정보(IP &amp; PORT)를 할당할 소켓의 파일 디스크립터.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">myaddr : 할당하고자 하는 주소정보를 지닌 구조체 변수의 주소.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">addrlen : 두 번째 인자로 전달된 구조체 변수의 길이.</span></div><div style=""><span style="background-color: rgb(255, 255, 255);">"성공시 0, 실패시 -1 반환"</span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div><div style=""><span style="background-color: rgb(255, 255, 255);"><br></span></div></div></div>
</article>
        </div>
    </section>

    <script src="/resources/index.js"></script>
</body>

</html>